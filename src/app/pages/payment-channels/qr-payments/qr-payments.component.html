<div class="dashboard-container">
  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-label">Active QR Codes</span>
        <div class="stat-icon icon-qr">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="8" height="8" rx="1"></rect>
            <rect x="13" y="3" width="8" height="8" rx="1"></rect>
            <rect x="3" y="13" width="8" height="8" rx="1"></rect>
            <rect x="13" y="13" width="8" height="8" rx="1"></rect>
          </svg>
        </div>
      </div>
      <div class="stat-value">{{ activeQRCodes }}</div>
      <div class="stat-change positive">{{ activeQRCodesChange }}</div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-label">Daily Scans</span>
        <div class="stat-icon icon-scans">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7"></path>
            <polyline points="3 7 12 13 21 7"></polyline>
            <line x1="12" y1="13" x2="12" y2="21"></line>
          </svg>
        </div>
      </div>
      <div class="stat-value">{{ dailyScans.toLocaleString() }}</div>
      <div class="stat-change positive">{{ dailyScansChange }}</div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-label">Daily Volume</span>
        <div class="stat-icon icon-volume">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
            <polyline points="17 6 23 6 23 12"></polyline>
          </svg>
        </div>
      </div>
      <div class="stat-value">${{ dailyVolume.toLocaleString() }}</div>
      <div class="stat-change positive">{{ dailyVolumeChange }}</div>
    </div>

    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-label">Unique Customers</span>
        <div class="stat-icon icon-customers">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
      </div>
      <div class="stat-value">{{ uniqueCustomers.toLocaleString() }}</div>
      <div class="stat-change neutral">{{ customersNote }}</div>
    </div>
  </div>

  <!-- Chart Section -->
  <div class="chart-section">
    <div class="chart-container">
      <h3 class="chart-title">Weekly QR Payment Volume by Type</h3>
      <svg class="chart-svg" viewBox="0 0 1200 280" preserveAspectRatio="xMidYMid meet">
        <defs>
          <linearGradient id="staticGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#dc2626;stop-opacity:0.1" />
            <stop offset="100%" style="stop-color:#dc2626;stop-opacity:0" />
          </linearGradient>
          <linearGradient id="dynamicGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#0891b2;stop-opacity:0.1" />
            <stop offset="100%" style="stop-color:#0891b2;stop-opacity:0" />
          </linearGradient>
        </defs>
        
        <!-- Grid lines -->
        <line x1="40" y1="40" x2="1180" y2="40" stroke="#e5e7eb" stroke-width="1"/>
        <line x1="40" y1="90" x2="1180" y2="90" stroke="#e5e7eb" stroke-width="1"/>
        <line x1="40" y1="140" x2="1180" y2="140" stroke="#e5e7eb" stroke-width="1"/>
        <line x1="40" y1="190" x2="1180" y2="190" stroke="#e5e7eb" stroke-width="1"/>
        <line x1="40" y1="240" x2="1180" y2="240" stroke="#e5e7eb" stroke-width="1"/>
        
        <!-- Y-axis labels -->
        <text x="5" y="45" font-size="12" fill="#6b7280">$24k</text>
        <text x="10" y="95" font-size="12" fill="#6b7280">$18k</text>
        <text x="10" y="145" font-size="12" fill="#6b7280">$12k</text>
        <text x="15" y="195" font-size="12" fill="#6b7280">$6k</text>
        <text x="15" y="245" font-size="12" fill="#6b7280">$0k</text>
        
        <!-- X-axis labels -->
        <text x="60" y="265" font-size="12" fill="#6b7280">Mon</text>
        <text x="220" y="265" font-size="12" fill="#6b7280">Tue</text>
        <text x="380" y="265" font-size="12" fill="#6b7280">Wed</text>
        <text x="540" y="265" font-size="12" fill="#6b7280">Thu</text>
        <text x="710" y="265" font-size="12" fill="#6b7280">Fri</text>
        <text x="870" y="265" font-size="12" fill="#6b7280">Sat</text>
        <text x="1030" y="265" font-size="12" fill="#6b7280">Sun</text>
        
        <!-- Bars for each day -->
        <g *ngFor="let item of chartData; let i = index">
          <!-- Static QR Bar (Red) -->
          <rect 
            [attr.x]="50 + (i * 165)" 
            [attr.y]="240 - (item.staticQR / 250)" 
            width="60" 
            [attr.height]="item.staticQR / 250"
            fill="#dc2626"
            rx="3"
          ></rect>
          
          <!-- Dynamic QR Bar (Blue) -->
          <rect 
            [attr.x]="120 + (i * 165)" 
            [attr.y]="240 - (item.dynamicQR / 250)" 
            width="60" 
            [attr.height]="item.dynamicQR / 250"
            fill="#0891b2"
            rx="3"
          ></rect>
        </g>
        
        <!-- Legend -->
        <circle cx="500" cy="20" r="5" fill="#dc2626"></circle>
        <text x="510" y="25" font-size="13" fill="#111827" font-weight="500">Static QR</text>
        
        <circle cx="600" cy="20" r="5" fill="#0891b2"></circle>
        <text x="610" y="25" font-size="13" fill="#111827" font-weight="500">Dynamic QR</text>
      </svg>
    </div>

    <!-- Recent Scans -->
    <div class="recent-scans-container">
      <h3 class="recent-scans-title">Recent Scans</h3>
      <div class="recent-scans-list">
        <div *ngFor="let scan of recentScans" class="scan-item">
          <div class="scan-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"></rect>
              <rect x="7" y="7" width="3" height="3"></rect>
              <rect x="14" y="7" width="3" height="3"></rect>
              <rect x="7" y="14" width="3" height="3"></rect>
              <rect x="14" y="14" width="3" height="3"></rect>
            </svg>
          </div>
          <div class="scan-info">
            <div class="scan-merchant">{{ scan.merchant }}</div>
            <div class="scan-qr-id">{{ scan.qrId }}</div>
          </div>
          <div class="scan-details">
            <div class="scan-amount">${{ scan.amount.toFixed(2) }}</div>
            <div class="scan-time">{{ scan.timestamp }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- QR Code Management Section -->
  <div class="qr-management-container">
    <div class="qr-management-header">
      <div class="qr-management-title-section">
        <h3 class="qr-management-title">QR Code Management</h3>
        <p class="qr-management-subtitle">Manage merchant QR payment codes</p>
      </div>
      <div class="qr-management-actions">
        <div class="search-box">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            placeholder="Search merchants..." 
            [(ngModel)]="searchQuery"
            class="search-input"
          />
        </div>
        <button class="btn-generate-qr" (click)="openGenerateModal()">
          <span class="btn-icon">+</span>
          Generate QR
        </button>
      </div>
    </div>

    <!-- Filter Tabs -->
    <div class="filter-tabs">
      <button 
        *ngFor="let filter of filters"
        [class.active]="selectedFilter === filter"
        (click)="setFilter(filter)"
        class="filter-tab"
      >
        {{ filter }}
      </button>
    </div>

    <!-- QR Codes Table -->
    <div class="table-container">
      <table class="qr-codes-table">
        <thead>
          <tr>
            <th>QR ID</th>
            <th>Merchant</th>
            <th>Type</th>
            <th>Location</th>
            <th>Status</th>
            <th>Daily Scans</th>
            <th>Daily Volume</th>
            <th>Last Scan</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let qr of filteredQRCodes">
            <td class="qr-id-cell">{{ qr.id }}</td>
            <td>
              <div class="merchant-info">
                <div class="merchant-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                </div>
                <span>{{ qr.merchant }}</span>
              </div>
            </td>
            <td>
              <span [class]="'type-badge type-' + qr.type">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                  <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                  <rect x="3" y="14" width="7" height="7" rx="1"></rect>
                  <rect x="14" y="14" width="7" height="7" rx="1"></rect>
                </svg>
                {{ qr.type }}
              </span>
            </td>
            <td class="location-cell">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              {{ qr.location }}
            </td>
            <td>
              <span [class]="'status-badge status-' + qr.status">
                <span class="status-dot"></span>
                {{ qr.status }}
              </span>
            </td>
            <td class="scans-cell">{{ qr.dailyScans }}</td>
            <td class="volume-cell">{{ qr.dailyVolume > 0 ? formatVolume(qr.dailyVolume) : '$0' }}</td>
            <td class="time-cell">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              {{ qr.lastScan }}
            </td>
            <td>
              <button class="btn-more" (click)="openQRDetailsModal(qr)">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <circle cx="12" cy="12" r="2"></circle>
                  <circle cx="12" cy="5" r="2"></circle>
                  <circle cx="12" cy="19" r="2"></circle>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Generate QR Modal -->
<div class="modal-overlay" *ngIf="showGenerateModal" (click)="closeGenerateModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="modal-title">Generate New QR Code</h3>
      <button class="modal-close" (click)="closeGenerateModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <p class="modal-subtitle">Create a new QR payment code for a merchant location.</p>
    
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Merchant</label>
        <select [(ngModel)]="selectedMerchant" class="form-select">
          <option value="" disabled>Select merchant</option>
          <option *ngFor="let merchant of merchants" [value]="merchant">{{ merchant }}</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">QR Type</label>
        <select [(ngModel)]="selectedQRType" class="form-select">
          <option value="" disabled>Select type</option>
          <option value="static">Static</option>
          <option value="dynamic">Dynamic</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">Location</label>
        <input 
          type="text" 
          [(ngModel)]="qrLocation"
          placeholder="Branch location (e.g., Avondale, Harare)"
          class="form-input"
        />
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeGenerateModal()">Cancel</button>
      <button 
        class="btn-generate" 
        (click)="generateQRCode()"
        [disabled]="!selectedMerchant || !selectedQRType || !qrLocation"
      >
        Generate QR Code
      </button>
    </div>
  </div>
</div>

<!-- QR Details Modal (More Options) -->
<div class="modal-overlay" *ngIf="showQRDetailsModal && selectedQRCode" (click)="closeQRDetailsModal()">
  <div class="qr-details-menu" (click)="$event.stopPropagation()">
    <button class="menu-item" (click)="viewQRCode(selectedQRCode!)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
        <circle cx="12" cy="12" r="3"></circle>
      </svg>
      View QR Code
    </button>
    <button class="menu-item" (click)="downloadQR(selectedQRCode!)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
      Download QR
    </button>
    <button class="menu-item" (click)="regenerateQR(selectedQRCode!)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="23 4 23 10 17 10"></polyline>
        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
      </svg>
      Regenerate
    </button>
    <button class="menu-item menu-item-danger" (click)="deactivateQR(selectedQRCode!)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
      </svg>
      Deactivate
    </button>
  </div>
</div>