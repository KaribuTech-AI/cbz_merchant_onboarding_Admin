<div class="banking-references-container">
  <!-- Banking References Section -->
  <div class="section-container">
    <div class="section-header">
      <i class="fas fa-university"></i>
      <h2 class="section-title">Banking References</h2>
    </div>

    <div class="bank-refs-form">
      @for (bankRef of bankReferences; track $index) {
        <div class="bank-refs-row">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Bank Name <span class="required">*</span></label>
              <input 
                nz-input 
                class="form-input" 
                placeholder="Enter bank name" 
                [(ngModel)]="bankRef.bankName" 
                (ngModelChange)="emitFormData()" 
              />
            </div>
            
            <div class="form-group">
              <label class="form-label">Branch</label>
              <input 
                nz-input 
                class="form-input" 
                placeholder="Enter branch name" 
                [(ngModel)]="bankRef.branch" 
                (ngModelChange)="emitFormData()" 
              />
            </div>
            
            <div class="form-group">
              <label class="form-label">Account Type <span class="required">*</span></label>
              <nz-select 
                class="form-select" 
                nzPlaceHolder="Select Account Type" 
                [(ngModel)]="bankRef.accountType" 
                (ngModelChange)="emitFormData()"
              >
                <nz-option nzValue="Current Account" nzLabel="Current Account"></nz-option>
                <nz-option nzValue="Savings Account" nzLabel="Savings Account"></nz-option>
                <nz-option nzValue="Business Account" nzLabel="Business Account"></nz-option>
              </nz-select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Currency Type <span class="required">*</span></label>
              <nz-select 
                class="form-select" 
                nzPlaceHolder="Select Currency" 
                [(ngModel)]="bankRef.currencyType" 
                (ngModelChange)="emitFormData()"
              >
                <nz-option nzValue="USD" nzLabel="USD"></nz-option>
                <nz-option nzValue="ZWG" nzLabel="ZWG"></nz-option>
                <nz-option nzValue="EUR" nzLabel="EUR"></nz-option>
              </nz-select>
            </div>
            
           <div class="form-group">
  <label class="form-label">Account Number <span class="required">*</span></label>
  <input
    class="form-input" 
    [(ngModel)]="bankRef.accountNumber" 
    (ngModelChange)="emitFormData()"
   
    style="width: 100%"
  >
</div>
            
            <div class="form-group">
              <label class="form-label">Creation Date <span class="required">*</span></label>
              <nz-date-picker 
                class="form-input" 
                nzPlaceHolder="Select creation date" 
                [(ngModel)]="bankRef.creationDate" 
                (ngModelChange)="emitFormData()"
              ></nz-date-picker>
            </div>
          </div>
          
          <div class="bank-refs-action">
            <button 
              nz-button 
              nzType="text" 
              nzDanger 
              class="delete-btn" 
              (click)="deleteBankReference($index)"
              [disabled]="bankReferences.length === 1"
            >
              <span nz-icon nzType="delete" nzTheme="outline"></span>
              Remove
            </button>
          </div>
        </div>
      }
      
      <div class="add-bank-section">
        <button 
          nz-button 
          nzType="dashed" 
          class="add-bank-btn" 
          (click)="addBankReference()"
        >
          <span nz-icon nzType="plus" nzTheme="outline"></span>
          Add Another Bank Reference
        </button>
      </div>
    </div>

    <!--For Affiliate businesses section -->
    <div class="affiliate-section">
      <div class="affiliate-header">
        <div class="affiliate-title">
          <i class="fas fa-building"></i>
          <h3>Affiliate Businesses</h3>
        </div>
        <p class="affiliate-description">
          Include businesses owned by the same directors, partners, shareholders, etc.
        </p>
      </div>
      
      <div class="company-details">
        <div class="company-details-header">
          <h4>Company Details</h4>
          <button 
            nz-button 
            nzType="primary" 
            class="add-company-btn" 
            (click)="showAddCompanyDrawer()"
          >
            <span nz-icon nzType="plus" nzTheme="outline"></span>
            Add Company
          </button>
        </div>
      </div>

      <!-- for Company Details Table -->
      <div class="table-container">
        <nz-table 
          #companyTable 
          [nzData]="companyList" 
          nzSize="middle" 
          [nzShowPagination]="false" 
          nzTableLayout="auto"
          class="company-table"
        >
          <thead>
            <tr>
              <th nzWidth="60px" class="table-header">#</th>
              <th class="table-header">Company Name</th>
              <th class="table-header">Reg. No.</th>
              <th class="table-header">Telephone</th>
              <th class="table-header">Email</th>
              <th nzWidth="100px" class="table-header">Action</th>
            </tr>
          </thead>
          <tbody>
            @for (company of companyTable.data; track $index) {
              <tr class="table-row">
                <td class="table-cell">{{ $index + 1 }}</td>
                <td class="table-cell">{{ company.companyName }}</td>
                <td class="table-cell">{{ company.registrationNumber }}</td>
                <td class="table-cell">{{ company.telephoneNumber }}</td>
                <td class="table-cell">{{ company.email }}</td>
                <td class="table-cell">
                  <button 
                    nz-button 
                    nzType="text" 
                    nzDanger 
                    class="table-delete-btn" 
                    (click)="deleteCompany($index)"
                  >
                    <span nz-icon nzType="delete" nzTheme="outline"></span>
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </nz-table>
      </div>
    </div>
  </div>
</div>

<!-- Add Company Drawer -->
<nz-drawer
  [nzVisible]="isAddCompanyVisible"
  [nzWidth]="600"
  nzTitle="Add Company"
  (nzOnClose)="closeAddCompanyDrawer()"
  [nzFooter]="drawerFooter"
  class="company-drawer"
>
  <ng-container *nzDrawerContent>
    <form nz-form [formGroup]="companyForm" class="drawer-form">
      <div class="drawer-content">
        <!-- First row with 2 columns -->
        <div class="drawer-form-row">
          <div class="drawer-form-group">
            <label class="drawer-form-label">Company Name <span class="required">*</span></label>
            <input 
              nz-input 
              class="drawer-form-input" 
              formControlName="companyName" 
              placeholder="Enter company registered name" 
            />
            @if (companyForm.get('companyName')?.invalid && (companyForm.get('companyName')?.dirty || companyForm.get('companyName')?.touched)) {
              <div class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Company Name is required
              </div>
            }
          </div>
          
          <div class="drawer-form-group">
            <label class="drawer-form-label">Registration Number <span class="required">*</span></label>
            <input 
              nz-input 
              class="drawer-form-input" 
              formControlName="registrationNumber" 
              placeholder="Enter registration number" 
            />
            @if (companyForm.get('registrationNumber')?.invalid && (companyForm.get('registrationNumber')?.dirty || companyForm.get('registrationNumber')?.touched)) {
              <div class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Registration Number is required
              </div>
            }
          </div>
        </div>

        <!-- Second row with 2 columns -->
        <div class="drawer-form-row">
        <div class="drawer-form-group">
  <label class="drawer-form-label">Telephone Number</label>
  <input
    class="drawer-form-input" 
    formControlName="telephoneNumber" 
    style="width: 100%"
  >
</div>
          
          <div class="drawer-form-group">
            <label class="drawer-form-label">Email</label>
            <input 
              nz-input 
              class="drawer-form-input" 
              formControlName="email" 
              placeholder="Enter email address" 
              type="email" 
            />
            @if (companyForm.get('email')?.invalid && (companyForm.get('email')?.dirty || companyForm.get('email')?.touched)) {
              <div class="error-message">
                <i class="fas fa-exclamation-circle"></i>
                Please enter a valid email address
              </div>
            }
          </div>
        </div>

        <!-- Phone number field -->
        <div class="drawer-form-row">
          <div class="drawer-form-group full-width">
            <label class="drawer-form-label">Phone Number</label>
            <nz-input-number 
              class="drawer-form-input" 
              formControlName="phoneNumber" 
              nzPlaceHolder="Enter phone number"
              [nzFormatter]="phoneNumberFormatter"
              [nzParser]="phoneNumberParser"
              [nzPrecision]="0"
              style="width: 100%"
            ></nz-input-number>
          </div>
        </div>

        <!-- Full width description field -->
        <div class="drawer-form-row">
          <div class="drawer-form-group full-width">
            <label class="drawer-form-label">Company Description</label>
            <textarea 
              nz-input 
              class="drawer-form-textarea" 
              formControlName="description" 
              placeholder="Enter company description" 
              rows="4"
            ></textarea>
          </div>
        </div>
      </div>
    </form>
  </ng-container>
  
  <ng-template #drawerFooter>
    <div class="drawer-footer">
      <button 
        nz-button 
        nzType="default" 
        class="cancel-btn" 
        (click)="closeAddCompanyDrawer()"
      >
        Cancel
      </button>
      <button 
        nz-button 
        nzType="primary" 
        class="add-btn" 
        (click)="addCompany()" 
        [disabled]="!companyForm.valid"
      >
        <span nz-icon nzType="plus" nzTheme="outline"></span>
        Add Company
      </button>
    </div>
  </ng-template>
</nz-drawer>